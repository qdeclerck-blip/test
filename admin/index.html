<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maison Yvoir — Tableau de bord</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        :root {
            --bg:#faf8f5; --bg-alt:#f2efe9; --bg-dark:#1a1a1a; --text:#2c2c2c;
            --text-light:#6b6b6b; --accent:#4a6741; --accent-dark:#3a5232;
            --accent-light:#6b8a5e; --border:#e0dcd5; --danger:#c0392b;
            --success:#27ae60; --warn:#f39c12;
            --font-serif:'Cormorant Garamond',Georgia,serif;
            --font-sans:'Inter',-apple-system,sans-serif;
            --sidebar-w:260px;
        }
        html { font-size:15px; -webkit-font-smoothing:antialiased; }
        body { font-family:var(--font-sans); background:var(--bg-alt); color:var(--text); display:flex; min-height:100vh; }

        /* --- Sidebar --- */
        .sidebar {
            width:var(--sidebar-w); background:var(--bg-dark); color:#fff; position:fixed;
            top:0; left:0; bottom:0; display:flex; flex-direction:column; z-index:100;
            transition:transform .3s ease;
        }
        .sidebar-brand { padding:2rem 1.5rem 1.5rem; border-bottom:1px solid rgba(255,255,255,.08); }
        .sidebar-brand h1 { font-family:var(--font-serif); font-weight:300; font-size:1.4rem; letter-spacing:.08em; }
        .sidebar-brand p { font-size:.65rem; color:rgba(255,255,255,.4); letter-spacing:.12em; text-transform:uppercase; margin-top:.25rem; }
        .sidebar-nav { flex:1; padding:1rem 0; overflow-y:auto; }
        .sidebar-nav a {
            display:flex; align-items:center; gap:.75rem; padding:.7rem 1.5rem;
            font-size:.85rem; color:rgba(255,255,255,.55); text-decoration:none;
            transition:all .2s; border-left:3px solid transparent;
        }
        .sidebar-nav a:hover { color:#fff; background:rgba(255,255,255,.05); }
        .sidebar-nav a.active { color:#fff; background:rgba(255,255,255,.08); border-left-color:var(--accent-light); }
        .sidebar-nav a svg { width:18px; height:18px; flex-shrink:0; }
        .sidebar-nav .nav-divider { height:1px; background:rgba(255,255,255,.06); margin:0.5rem 1.5rem; }
        .sidebar-footer { padding:1rem 1.5rem; border-top:1px solid rgba(255,255,255,.08); }
        .sidebar-footer .user-info { font-size:.8rem; color:rgba(255,255,255,.5); margin-bottom:.5rem; }
        .sidebar-footer button {
            width:100%; padding:.6rem; font-family:var(--font-sans); font-size:.8rem;
            background:rgba(255,255,255,.08); color:rgba(255,255,255,.7); border:none;
            border-radius:6px; cursor:pointer; transition:all .2s;
        }
        .sidebar-footer button:hover { background:rgba(255,255,255,.15); color:#fff; }

        /* --- Main --- */
        .main { flex:1; margin-left:var(--sidebar-w); }
        .topbar {
            position:sticky; top:0; z-index:50; background:rgba(250,248,245,.92);
            backdrop-filter:blur(12px); border-bottom:1px solid var(--border);
            padding:1rem 2rem; display:flex; align-items:center; justify-content:space-between;
        }
        .topbar h2 { font-family:var(--font-serif); font-weight:400; font-size:1.4rem; }
        .topbar-actions { display:flex; gap:.75rem; align-items:center; }
        .content { padding:2rem; max-width:1100px; }

        /* --- Buttons --- */
        .btn {
            display:inline-flex; align-items:center; gap:.5rem; padding:.6rem 1.25rem;
            font-family:var(--font-sans); font-size:.82rem; font-weight:500;
            border:none; border-radius:8px; cursor:pointer; transition:all .2s;
            text-decoration:none;
        }
        .btn-primary { background:var(--accent); color:#fff; }
        .btn-primary:hover { background:var(--accent-dark); transform:translateY(-1px); box-shadow:0 4px 12px rgba(74,103,65,.2); }
        .btn-secondary { background:var(--bg); color:var(--text); border:1px solid var(--border); }
        .btn-secondary:hover { background:var(--bg-alt); }
        .btn-danger { background:rgba(192,57,43,.08); color:var(--danger); border:1px solid rgba(192,57,43,.15); }
        .btn-danger:hover { background:rgba(192,57,43,.15); }
        .btn-sm { padding:.4rem .9rem; font-size:.75rem; }
        .btn-icon { padding:.5rem; width:34px; height:34px; justify-content:center; }
        .btn svg { width:16px; height:16px; }

        /* --- Cards --- */
        .card {
            background:var(--bg); border-radius:12px; border:1px solid var(--border);
            margin-bottom:1.5rem; overflow:hidden;
        }
        .card-header {
            padding:1.25rem 1.5rem; border-bottom:1px solid var(--border);
            display:flex; align-items:center; justify-content:space-between;
        }
        .card-header h3 { font-family:var(--font-serif); font-weight:400; font-size:1.15rem; }
        .card-body { padding:1.5rem; }

        /* --- Form fields --- */
        .field { margin-bottom:1.25rem; }
        .field label {
            display:block; font-size:.72rem; font-weight:500; letter-spacing:.08em;
            text-transform:uppercase; color:var(--text-light); margin-bottom:.4rem;
        }
        .field input, .field textarea, .field select {
            width:100%; padding:.7rem .9rem; font-family:var(--font-sans); font-size:.9rem;
            color:var(--text); background:var(--bg-alt); border:1px solid var(--border);
            border-radius:8px; transition:border-color .2s, box-shadow .2s;
        }
        .field input:focus, .field textarea:focus, .field select:focus {
            outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(74,103,65,.1);
        }
        .field textarea { resize:vertical; min-height:80px; line-height:1.6; }
        .field-row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
        .field-hint { font-size:.72rem; color:var(--text-light); margin-top:.25rem; }

        /* --- Toast --- */
        .toast {
            position:fixed; bottom:2rem; right:2rem; padding:.85rem 1.5rem;
            background:var(--bg-dark); color:#fff; border-radius:10px; font-size:.85rem;
            box-shadow:0 8px 32px rgba(0,0,0,.2); transform:translateY(120%);
            transition:transform .4s cubic-bezier(.25,.46,.45,.94); z-index:9999;
        }
        .toast.visible { transform:translateY(0); }
        .toast.success { background:var(--success); }
        .toast.error { background:var(--danger); }

        /* --- Image grid --- */
        .image-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:1rem; }
        .image-card {
            position:relative; border-radius:8px; overflow:hidden; background:var(--bg-alt);
            border:1px solid var(--border); aspect-ratio:1; cursor:pointer; transition:all .2s;
        }
        .image-card:hover { box-shadow:0 4px 16px rgba(0,0,0,.1); transform:translateY(-2px); }
        .image-card img { width:100%; height:100%; object-fit:cover; }
        .image-card .image-actions {
            position:absolute; top:.5rem; right:.5rem; display:flex; gap:.25rem;
            opacity:0; transition:opacity .2s;
        }
        .image-card:hover .image-actions { opacity:1; }
        .image-card .image-name {
            position:absolute; bottom:0; left:0; right:0; padding:.5rem;
            background:linear-gradient(transparent, rgba(0,0,0,.7));
            font-size:.7rem; color:#fff; word-break:break-all;
        }

        /* --- Upload zone --- */
        .upload-zone {
            border:2px dashed var(--border); border-radius:12px; padding:2.5rem;
            text-align:center; cursor:pointer; transition:all .2s; background:var(--bg);
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color:var(--accent); background:rgba(74,103,65,.03);
        }
        .upload-zone svg { width:40px; height:40px; color:var(--text-light); margin-bottom:.75rem; }
        .upload-zone p { font-size:.88rem; color:var(--text-light); }
        .upload-zone span { font-size:.75rem; color:var(--text-light); opacity:.6; }
        .upload-zone input[type="file"] { display:none; }

        /* --- Section nav tabs --- */
        .section-tabs { display:flex; gap:0; margin-bottom:1.5rem; border-bottom:1px solid var(--border); }
        .section-tab {
            padding:.75rem 1.25rem; font-size:.82rem; font-weight:500; color:var(--text-light);
            background:none; border:none; border-bottom:2px solid transparent;
            cursor:pointer; transition:all .2s; margin-bottom:-1px;
        }
        .section-tab:hover { color:var(--text); }
        .section-tab.active { color:var(--accent); border-bottom-color:var(--accent); }

        /* --- Panel visibility --- */
        .panel { display:none; }
        .panel.active { display:block; }

        /* --- Items list (rooms, services, etc.) --- */
        .item-list { display:flex; flex-direction:column; gap:.75rem; }
        .item-entry {
            background:var(--bg-alt); border:1px solid var(--border); border-radius:8px;
            padding:1rem 1.25rem; display:flex; gap:1rem; align-items:flex-start;
        }
        .item-entry .item-fields { flex:1; display:flex; flex-direction:column; gap:.5rem; }
        .item-entry input, .item-entry textarea {
            width:100%; padding:.5rem .7rem; font-family:var(--font-sans); font-size:.85rem;
            border:1px solid var(--border); border-radius:6px; background:var(--bg);
        }
        .item-entry textarea { min-height:60px; resize:vertical; }
        .item-entry .item-number { font-family:var(--font-serif); font-size:1.3rem; color:var(--text-light); min-width:1.5rem; }

        /* --- Password modal --- */
        .modal-overlay {
            position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:9000;
            display:none; align-items:center; justify-content:center;
        }
        .modal-overlay.visible { display:flex; }
        .modal {
            background:var(--bg); border-radius:16px; padding:2rem; max-width:420px;
            width:90%; box-shadow:0 24px 80px rgba(0,0,0,.3);
        }
        .modal h3 { font-family:var(--font-serif); font-weight:400; font-size:1.3rem; margin-bottom:1.5rem; }

        /* --- Responsive --- */
        .mobile-toggle {
            display:none; position:fixed; top:1rem; left:1rem; z-index:200;
            background:var(--bg-dark); color:#fff; border:none; border-radius:8px;
            padding:.5rem .75rem; cursor:pointer;
        }
        @media(max-width:768px) {
            .sidebar { transform:translateX(-100%); }
            .sidebar.open { transform:translateX(0); }
            .main { margin-left:0; }
            .mobile-toggle { display:block; }
            .content { padding:1rem; }
            .field-row { grid-template-columns:1fr; }
            .image-grid { grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); }
        }
    </style>
</head>
<body>

<button class="mobile-toggle" id="mobileToggle">&#9776;</button>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
        <h1>Maison Yvoir</h1>
        <p>Tableau de bord</p>
    </div>
    <nav class="sidebar-nav">
        <a href="#" data-panel="hero" class="active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg>
            Hero
        </a>
        <a href="#" data-panel="concept">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            Concept
        </a>
        <a href="#" data-panel="stats">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
            Statistiques
        </a>
        <a href="#" data-panel="maison">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/></svg>
            La Maison
        </a>
        <a href="#" data-panel="services">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
            Services
        </a>
        <a href="#" data-panel="decouvrir">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="10" r="3"/><path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 10-16 0c0 3 2.7 7 8 11.7z"/></svg>
            Découvrir
        </a>
        <a href="#" data-panel="gallery">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
            Galerie
        </a>
        <a href="#" data-panel="quote">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3z"/></svg>
            Citation
        </a>
        <a href="#" data-panel="seasons">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
            Saisons
        </a>
        <a href="#" data-panel="contact">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6l-10 7L2 6"/></svg>
            Contact
        </a>
        <div class="nav-divider"></div>
        <a href="#" data-panel="images">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
            Images
        </a>
        <a href="#" data-panel="settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
            Paramètres
        </a>
    </nav>
    <div class="sidebar-footer">
        <div class="user-info" id="userInfo">admin</div>
        <button id="logoutBtn">Se déconnecter</button>
    </div>
</aside>

<!-- Main Content -->
<div class="main">
    <div class="topbar">
        <h2 id="topbarTitle">Hero</h2>
        <div class="topbar-actions">
            <a href="/" target="_blank" class="btn btn-secondary btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14L21 3"/></svg>
                Voir le site
            </a>
        </div>
    </div>
    <div class="content" id="content">

        <!-- HERO Panel -->
        <div class="panel active" id="panel-hero">
            <div class="card"><div class="card-header"><h3>Section Hero</h3></div><div class="card-body">
                <div class="field"><label>Sous-titre localisation</label><input type="text" data-path="hero.label"></div>
                <div class="field-row">
                    <div class="field"><label>Titre — ligne 1</label><input type="text" data-path="hero.title_line1"></div>
                    <div class="field"><label>Titre — ligne 2 (italique)</label><input type="text" data-path="hero.title_line2"></div>
                </div>
                <div class="field"><label>Description</label><textarea rows="3" data-path="hero.subtitle"></textarea></div>
                <button class="btn btn-primary save-section" data-section="hero">Enregistrer</button>
            </div></div>
        </div>

        <!-- CONCEPT Panel -->
        <div class="panel" id="panel-concept">
            <div class="card"><div class="card-header"><h3>Section Concept</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="concept.label"></div>
                <div class="field"><label>Titre (HTML autorisé: &lt;em&gt;)</label><input type="text" data-path="concept.title"></div>
                <div class="field"><label>Paragraphe 1</label><textarea rows="4" data-path="concept.paragraphs.0"></textarea></div>
                <div class="field"><label>Paragraphe 2</label><textarea rows="4" data-path="concept.paragraphs.1"></textarea></div>
                <div class="field-row">
                    <div class="field"><label>Légende image 1</label><input type="text" data-path="concept.image1_caption"></div>
                    <div class="field"><label>Légende image 2</label><input type="text" data-path="concept.image2_caption"></div>
                </div>
                <button class="btn btn-primary save-section" data-section="concept">Enregistrer</button>
            </div></div>
        </div>

        <!-- STATS Panel -->
        <div class="panel" id="panel-stats">
            <div class="card"><div class="card-header"><h3>Statistiques</h3></div><div class="card-body">
                <div class="item-list" id="statsList"></div>
                <button class="btn btn-primary save-section" data-section="stats" style="margin-top:1rem;">Enregistrer</button>
            </div></div>
        </div>

        <!-- MAISON Panel -->
        <div class="panel" id="panel-maison">
            <div class="card"><div class="card-header"><h3>La Maison</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="maison.label"></div>
                <div class="field"><label>Titre</label><input type="text" data-path="maison.title"></div>
                <div class="field"><label>Introduction</label><textarea rows="3" data-path="maison.intro"></textarea></div>
            </div></div>
            <div class="card"><div class="card-header"><h3>Pièces</h3></div><div class="card-body">
                <div class="item-list" id="roomsList"></div>
                <button class="btn btn-primary save-section" data-section="maison" style="margin-top:1rem;">Enregistrer</button>
            </div></div>
        </div>

        <!-- SERVICES Panel -->
        <div class="panel" id="panel-services">
            <div class="card"><div class="card-header"><h3>Services</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="services.label"></div>
                <div class="field"><label>Titre</label><input type="text" data-path="services.title"></div>
            </div></div>
            <div class="card"><div class="card-header"><h3>Liste des services</h3></div><div class="card-body">
                <div class="item-list" id="servicesList"></div>
                <button class="btn btn-primary save-section" data-section="services" style="margin-top:1rem;">Enregistrer</button>
            </div></div>
        </div>

        <!-- DECOUVRIR Panel -->
        <div class="panel" id="panel-decouvrir">
            <div class="card"><div class="card-header"><h3>Découvrir Yvoir</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="decouvrir.label"></div>
                <div class="field"><label>Titre</label><input type="text" data-path="decouvrir.title"></div>
                <div class="field"><label>Introduction</label><textarea rows="3" data-path="decouvrir.intro"></textarea></div>
            </div></div>
            <div class="card"><div class="card-header"><h3>Lieux à découvrir</h3></div><div class="card-body">
                <div class="item-list" id="decouvrirList"></div>
                <button class="btn btn-primary save-section" data-section="decouvrir" style="margin-top:1rem;">Enregistrer</button>
            </div></div>
        </div>

        <!-- GALLERY Panel -->
        <div class="panel" id="panel-gallery">
            <div class="card"><div class="card-header"><h3>Galerie</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="gallery.label"></div>
                <div class="field"><label>Titre</label><input type="text" data-path="gallery.title"></div>
            </div></div>
            <div class="card"><div class="card-header"><h3>Photos</h3><p class="field-hint">Les images larges s'étendent sur 2 colonnes</p></div><div class="card-body">
                <div class="item-list" id="galleryList"></div>
                <button class="btn btn-primary save-section" data-section="gallery" style="margin-top:1rem;">Enregistrer</button>
            </div></div>
        </div>

        <!-- QUOTE Panel -->
        <div class="panel" id="panel-quote">
            <div class="card"><div class="card-header"><h3>Citation</h3></div><div class="card-body">
                <div class="field"><label>Texte de la citation</label><textarea rows="4" data-path="quote"></textarea></div>
                <button class="btn btn-primary save-section" data-section="quote">Enregistrer</button>
            </div></div>
        </div>

        <!-- SEASONS Panel -->
        <div class="panel" id="panel-seasons">
            <div class="card"><div class="card-header"><h3>Saisons</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="seasons.label"></div>
                <div class="field"><label>Titre</label><input type="text" data-path="seasons.title"></div>
            </div></div>
            <div class="card"><div class="card-header"><h3>Les 4 saisons</h3></div><div class="card-body">
                <div class="item-list" id="seasonsList"></div>
                <button class="btn btn-primary save-section" data-section="seasons" style="margin-top:1rem;">Enregistrer</button>
            </div></div>
        </div>

        <!-- CONTACT Panel -->
        <div class="panel" id="panel-contact">
            <div class="card"><div class="card-header"><h3>Contact & Réservation</h3></div><div class="card-body">
                <div class="field"><label>Label</label><input type="text" data-path="contact.label"></div>
                <div class="field"><label>Titre</label><input type="text" data-path="contact.title"></div>
                <div class="field"><label>Description</label><textarea rows="3" data-path="contact.description"></textarea></div>
                <div class="field"><label>Email</label><input type="email" data-path="contact.email"></div>
                <div class="field"><label>Téléphone</label><input type="text" data-path="contact.phone"></div>
                <div class="field"><label>Adresse</label><input type="text" data-path="contact.address"></div>
                <button class="btn btn-primary save-section" data-section="contact">Enregistrer</button>
            </div></div>
        </div>

        <!-- IMAGES Panel -->
        <div class="panel" id="panel-images">
            <div class="card"><div class="card-header"><h3>Bibliothèque d'images</h3></div><div class="card-body">
                <div class="upload-zone" id="uploadZone">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    <p>Glissez-déposez vos images ici</p>
                    <span>JPEG, PNG, WebP — max 10 MB</span>
                    <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp,image/avif" multiple>
                </div>
                <div class="image-grid" id="imageGrid" style="margin-top:1.5rem;"></div>
            </div></div>
        </div>

        <!-- SETTINGS Panel -->
        <div class="panel" id="panel-settings">
            <div class="card"><div class="card-header"><h3>Pied de page</h3></div><div class="card-body">
                <div class="field"><label>Slogan</label><input type="text" data-path="footer.tagline"></div>
                <button class="btn btn-primary save-section" data-section="footer">Enregistrer</button>
            </div></div>
            <div class="card"><div class="card-header"><h3>Session</h3></div><div class="card-body">
                <p style="font-size:.85rem;color:var(--text-light);margin-bottom:1rem;">Vous êtes connecté via votre token GitHub. Le token est stocké uniquement dans la session de votre navigateur et sera supprimé à la fermeture de l'onglet.</p>
                <button class="btn btn-danger" id="logoutBtn">Se déconnecter</button>
            </div></div>
        </div>

    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
(function() {
    'use strict';

    // --- GitHub API config ---
    var GH_TOKEN = sessionStorage.getItem('gh_token');
    var GH_REPO = sessionStorage.getItem('gh_repo') || 'qdeclerck-blip/test';
    var GH_BRANCH = 'main'; // branch to commit to
    var GH_API = 'https://api.github.com';
    var contentSha = ''; // SHA of current content.json for updates

    if (!GH_TOKEN) { window.location.href = 'login.html'; }

    var content = {};
    var toastTimer;

    function toast(msg, type) {
        var el = document.getElementById('toast');
        el.textContent = msg;
        el.className = 'toast visible ' + (type || '');
        clearTimeout(toastTimer);
        toastTimer = setTimeout(function() { el.classList.remove('visible'); }, 3500);
    }

    function ghFetch(path, opts) {
        opts = opts || {};
        opts.headers = opts.headers || {};
        opts.headers['Authorization'] = 'token ' + GH_TOKEN;
        opts.headers['Accept'] = 'application/vnd.github.v3+json';
        return fetch(GH_API + path, opts);
    }

    function deepGet(obj, path) {
        return path.split('.').reduce(function(o, k) { return o != null ? o[k] : undefined; }, obj);
    }
    function deepSet(obj, path, val) {
        var keys = path.split('.'); var last = keys.pop();
        keys.reduce(function(o, k) { return o[k]; }, obj)[last] = val;
    }

    // --- Load content from GitHub ---
    function loadContent() {
        ghFetch('/repos/' + GH_REPO + '/contents/data/content.json?ref=' + GH_BRANCH)
            .then(function(r) { if (!r.ok) throw new Error('not found'); return r.json(); })
            .then(function(file) {
                contentSha = file.sha;
                var decoded = atob(file.content.replace(/\n/g, ''));
                // Handle UTF-8
                var bytes = new Uint8Array(decoded.length);
                for (var i = 0; i < decoded.length; i++) bytes[i] = decoded.charCodeAt(i);
                var text = new TextDecoder('utf-8').decode(bytes);
                content = JSON.parse(text);
                populateFields();
                buildDynamicLists();
                toast('Contenu chargé', 'success');
            })
            .catch(function(err) {
                toast('Erreur: impossible de charger le contenu', 'error');
                console.error(err);
            });
    }

    function populateFields() {
        document.querySelectorAll('[data-path]').forEach(function(el) {
            var val = deepGet(content, el.getAttribute('data-path'));
            if (val !== undefined) el.value = val;
        });
    }

    // --- Save content to GitHub via commit ---
    function saveToGitHub(updatedContent) {
        var jsonStr = JSON.stringify(updatedContent, null, 2);
        var encoded = btoa(unescape(encodeURIComponent(jsonStr)));

        return ghFetch('/repos/' + GH_REPO + '/contents/data/content.json', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: 'Update: contenu modifié via admin CMS',
                content: encoded,
                sha: contentSha,
                branch: GH_BRANCH
            })
        })
        .then(function(r) {
            if (!r.ok) return r.json().then(function(d) { throw new Error(d.message || 'Erreur GitHub'); });
            return r.json();
        })
        .then(function(res) {
            contentSha = res.content.sha;
            return true;
        });
    }

    // --- Collect section data ---
    function collectSection(section) {
        if (section === 'stats') return collectStats();
        if (section === 'quote') {
            var ta = document.querySelector('[data-path="quote"]');
            return ta ? ta.value : content.quote;
        }
        var data = JSON.parse(JSON.stringify(content[section] || {}));
        document.querySelectorAll('#panel-' + section + ' [data-path]').forEach(function(el) {
            var path = el.getAttribute('data-path');
            if (path.startsWith(section + '.')) deepSet(data, path.substring(section.length + 1), el.value);
        });
        if (section === 'maison') data.rooms = collectItemList('roomsList', ['name', 'description']);
        if (section === 'services') data.items = collectServiceList();
        if (section === 'decouvrir') data.cards = collectDecouvrirList();
        if (section === 'gallery') data.items = collectGalleryList();
        if (section === 'seasons') data.items = collectItemList('seasonsList', ['name', 'description']);
        return data;
    }

    function collectStats() {
        var items = [];
        document.querySelectorAll('#statsList .item-entry').forEach(function(e) {
            items.push({ value: parseInt(e.querySelector('[data-field="value"]').value, 10) || 0,
                unit: e.querySelector('[data-field="unit"]').value, label: e.querySelector('[data-field="label"]').value });
        }); return items;
    }
    function collectItemList(id, fields) {
        var items = [];
        document.querySelectorAll('#' + id + ' .item-entry').forEach(function(e) {
            var item = {}; fields.forEach(function(f) { var el = e.querySelector('[data-field="' + f + '"]'); if (el) item[f] = el.value; });
            items.push(item);
        }); return items;
    }
    function collectServiceList() {
        var items = [];
        document.querySelectorAll('#servicesList .item-entry').forEach(function(e) {
            items.push({ icon: e.querySelector('[data-field="icon"]').value, title: e.querySelector('[data-field="title"]').value,
                description: e.querySelector('[data-field="description"]').value });
        }); return items;
    }
    function collectDecouvrirList() {
        var items = [];
        document.querySelectorAll('#decouvrirList .item-entry').forEach(function(e) {
            items.push({ number: e.querySelector('[data-field="number"]').value, title: e.querySelector('[data-field="title"]').value,
                description: e.querySelector('[data-field="description"]').value });
        }); return items;
    }
    function collectGalleryList() {
        var items = [];
        document.querySelectorAll('#galleryList .item-entry').forEach(function(e) {
            items.push({ caption: e.querySelector('[data-field="caption"]').value, wide: e.querySelector('[data-field="wide"]').checked });
        }); return items;
    }

    // --- Build dynamic lists ---
    function buildDynamicLists() { buildStatsList(); buildRoomsList(); buildServicesList(); buildDecouvrirList(); buildGalleryList(); buildSeasonsList(); }

    function buildStatsList() {
        var c = document.getElementById('statsList'); c.innerHTML = '';
        (content.stats || []).forEach(function(s, i) {
            c.innerHTML += '<div class="item-entry"><span class="item-number">' + (i+1) + '</span><div class="item-fields">' +
                '<input data-field="value" type="number" value="' + s.value + '" placeholder="Valeur">' +
                '<input data-field="unit" value="' + esc(s.unit) + '" placeholder="Unité">' +
                '<input data-field="label" value="' + esc(s.label) + '" placeholder="Label"></div></div>';
        });
    }
    function buildRoomsList() {
        var c = document.getElementById('roomsList'); c.innerHTML = '';
        (content.maison && content.maison.rooms || []).forEach(function(r, i) {
            c.innerHTML += '<div class="item-entry"><span class="item-number">' + (i+1) + '</span><div class="item-fields">' +
                '<input data-field="name" value="' + esc(r.name) + '" placeholder="Nom">' +
                '<textarea data-field="description" placeholder="Description">' + esc(r.description) + '</textarea></div></div>';
        });
    }
    function buildServicesList() {
        var c = document.getElementById('servicesList'); c.innerHTML = '';
        (content.services && content.services.items || []).forEach(function(s, i) {
            c.innerHTML += '<div class="item-entry"><span class="item-number">' + (i+1) + '</span><div class="item-fields">' +
                '<input data-field="icon" value="' + esc(s.icon) + '" placeholder="Icône">' +
                '<input data-field="title" value="' + esc(s.title) + '" placeholder="Titre">' +
                '<textarea data-field="description" placeholder="Description">' + esc(s.description) + '</textarea></div></div>';
        });
    }
    function buildDecouvrirList() {
        var c = document.getElementById('decouvrirList'); c.innerHTML = '';
        (content.decouvrir && content.decouvrir.cards || []).forEach(function(d, i) {
            c.innerHTML += '<div class="item-entry"><span class="item-number">' + esc(d.number) + '</span><div class="item-fields">' +
                '<input data-field="number" value="' + esc(d.number) + '" placeholder="Numéro">' +
                '<input data-field="title" value="' + esc(d.title) + '" placeholder="Titre">' +
                '<textarea data-field="description" placeholder="Description">' + esc(d.description) + '</textarea></div></div>';
        });
    }
    function buildGalleryList() {
        var c = document.getElementById('galleryList'); c.innerHTML = '';
        (content.gallery && content.gallery.items || []).forEach(function(g, i) {
            c.innerHTML += '<div class="item-entry"><span class="item-number">' + (i+1) + '</span><div class="item-fields">' +
                '<input data-field="caption" value="' + esc(g.caption) + '" placeholder="Légende">' +
                '<label style="font-size:.8rem;display:flex;align-items:center;gap:.5rem;margin-top:.25rem;text-transform:none;letter-spacing:0"><input data-field="wide" type="checkbox"' + (g.wide ? ' checked' : '') + '> Image large (2 colonnes)</label></div></div>';
        });
    }
    function buildSeasonsList() {
        var c = document.getElementById('seasonsList'); c.innerHTML = '';
        (content.seasons && content.seasons.items || []).forEach(function(s, i) {
            c.innerHTML += '<div class="item-entry"><span class="item-number">' + (i+1) + '</span><div class="item-fields">' +
                '<input data-field="name" value="' + esc(s.name) + '" placeholder="Nom">' +
                '<textarea data-field="description" placeholder="Description">' + esc(s.description) + '</textarea></div></div>';
        });
    }

    function esc(s) { return String(s || '').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // --- Save section (commits to GitHub) ---
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('save-section')) return;
        var section = e.target.getAttribute('data-section');
        var data = collectSection(section);
        e.target.disabled = true;
        e.target.textContent = 'Sauvegarde...';

        // Update content object then commit entire file
        content[section] = data;
        saveToGitHub(content).then(function() {
            toast('Section "' + section + '" publiée sur le site !', 'success');
        }).catch(function(err) {
            toast('Erreur: ' + (err.message || 'échec de la sauvegarde'), 'error');
        }).finally(function() {
            e.target.disabled = false;
            e.target.textContent = 'Enregistrer';
        });
    });

    // --- Navigation ---
    var titles = {
        hero:'Hero', concept:'Concept', stats:'Statistiques', maison:'La Maison',
        services:'Services', decouvrir:'Découvrir Yvoir', gallery:'Galerie',
        quote:'Citation', seasons:'Saisons', contact:'Contact',
        images:'Images', settings:'Paramètres'
    };

    document.querySelectorAll('.sidebar-nav a').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            var panel = this.getAttribute('data-panel');
            document.querySelectorAll('.panel').forEach(function(p) { p.classList.remove('active'); });
            document.querySelectorAll('.sidebar-nav a').forEach(function(a) { a.classList.remove('active'); });
            document.getElementById('panel-' + panel).classList.add('active');
            this.classList.add('active');
            document.getElementById('topbarTitle').textContent = titles[panel] || panel;
            document.getElementById('sidebar').classList.remove('open');
        });
    });

    document.getElementById('mobileToggle').addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('open');
    });

    // --- Logout ---
    document.getElementById('logoutBtn').addEventListener('click', function() {
        sessionStorage.removeItem('gh_token');
        sessionStorage.removeItem('gh_repo');
        window.location.href = 'login.html';
    });

    // --- Image upload via GitHub API ---
    var uploadZone = document.getElementById('uploadZone');
    var fileInput = document.getElementById('fileInput');

    uploadZone.addEventListener('click', function() { fileInput.click(); });
    uploadZone.addEventListener('dragover', function(e) { e.preventDefault(); uploadZone.classList.add('dragover'); });
    uploadZone.addEventListener('dragleave', function() { uploadZone.classList.remove('dragover'); });
    uploadZone.addEventListener('drop', function(e) {
        e.preventDefault(); uploadZone.classList.remove('dragover');
        if (e.dataTransfer.files.length) uploadFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', function() { if (this.files.length) uploadFiles(this.files); });

    function uploadFiles(files) {
        Array.from(files).forEach(function(file) {
            if (file.size > 10 * 1024 * 1024) { toast('Fichier trop volumineux (max 10 MB)', 'error'); return; }
            toast('Upload en cours...', '');
            var reader = new FileReader();
            reader.onload = function() {
                var base64 = reader.result.split(',')[1];
                var safeName = Date.now() + '-' + file.name.replace(/[^a-zA-Z0-9._-]/g, '_');
                ghFetch('/repos/' + GH_REPO + '/contents/images/' + safeName, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'Add: image ' + safeName,
                        content: base64,
                        branch: GH_BRANCH
                    })
                })
                .then(function(r) { if (!r.ok) throw new Error('Upload échoué'); return r.json(); })
                .then(function() { toast('Image "' + file.name + '" uploadée !', 'success'); loadImages(); })
                .catch(function(err) { toast('Erreur upload: ' + err.message, 'error'); });
            };
            reader.readAsDataURL(file);
        });
    }

    function loadImages() {
        ghFetch('/repos/' + GH_REPO + '/contents/images?ref=' + GH_BRANCH)
            .then(function(r) { if (!r.ok) throw new Error('no images'); return r.json(); })
            .then(function(files) {
                var grid = document.getElementById('imageGrid');
                grid.innerHTML = '';
                files.filter(function(f) { return /\.(jpg|jpeg|png|webp|avif|gif)$/i.test(f.name); })
                    .forEach(function(img) {
                        var card = document.createElement('div');
                        card.className = 'image-card';
                        var imgUrl = 'https://raw.githubusercontent.com/' + GH_REPO + '/' + GH_BRANCH + '/images/' + img.name;
                        card.innerHTML = '<img src="' + imgUrl + '" alt="" loading="lazy">' +
                            '<div class="image-actions"><button class="btn btn-danger btn-icon btn-sm" data-delete="' + img.name + '" data-sha="' + img.sha + '" title="Supprimer"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="14" height="14"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></button></div>' +
                            '<div class="image-name">' + img.name + '</div>';
                        card.addEventListener('click', function(e) {
                            var delBtn = e.target.closest('[data-delete]');
                            if (delBtn) {
                                if (confirm('Supprimer ' + delBtn.getAttribute('data-delete') + ' ?')) {
                                    ghFetch('/repos/' + GH_REPO + '/contents/images/' + delBtn.getAttribute('data-delete'), {
                                        method: 'DELETE',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ message: 'Remove: image ' + delBtn.getAttribute('data-delete'), sha: delBtn.getAttribute('data-sha'), branch: GH_BRANCH })
                                    }).then(function() { toast('Image supprimée', 'success'); loadImages(); });
                                }
                            } else {
                                navigator.clipboard.writeText(imgUrl).then(function() { toast('URL copiée !', 'success'); });
                            }
                        });
                        grid.appendChild(card);
                    });
            })
            .catch(function() {
                document.getElementById('imageGrid').innerHTML = '<p style="color:var(--text-light);font-size:.85rem;">Aucune image. Uploadez votre première image ci-dessus.</p>';
            });
    }

    // --- Init ---
    ghFetch('/user').then(function(r) {
        if (!r.ok) throw new Error('auth');
        return r.json();
    }).then(function(user) {
        document.getElementById('userInfo').textContent = user.login;
    }).catch(function() {
        sessionStorage.removeItem('gh_token');
        window.location.href = 'login.html';
    });

    loadContent();
    loadImages();

})();
</script>
</body>
</html>
